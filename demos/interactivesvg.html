<h1>SVG Path</h1>
<!-- from: http://www.w3schools.com/graphics/svg_path.asp -->


<svg id="path" height="400" width="450">
  <path id="line" d="M 100 350 L 250 50 L 400 350" stroke="red" stroke-width="3" fill="none" />
  <path id="curve" d="M 100 350 Q 250 50 400 350" stroke="green" stroke-width="5" fill="none" />

  <!-- Mark relevant points -->
  <g stroke="black" stroke-width="3" fill="black">
    <circle id="pointA" cx="100" cy="350" r="3" />
    <circle id="pointB" cx="250" cy="50" r="3" />
    <circle id="pointC" cx="400" cy="350" r="3" />
  </g>
  <!-- Label the points -->
  <g font-size="30" font-family="sans-serif" fill="black" stroke="none"
  text-anchor="middle">
    <text id="textA"  x="100" y="350" dx="-30">A</text>
    <text x="250" y="50" dy="-10">B</text>
    <text x="400" y="350" dx="30">C</text>
  </g>
</svg>

<script>
  var p = document.querySelector("#pointA")
  var t = document.querySelector("#textA")
  var l = document.querySelector("#line")
  var c = document.querySelector("#curve")
  
  getVertices = function(p) {
    return p.getAttribute("d").split(/(?=[ML] +)/).map( ea => {
      var m = ea.split(/ +/)
      var pos = {c: m[0], x1: parseFloat(m[1]), y1: parseFloat(m[2]), toString: function() { return JSON.stringify(this)}}
      if (m[3]) {
        pos.x2 = parseFloat(m[3]);
        pos.y2 = parseFloat(m[4]);
      }
      return pos  
    })
  }
  setVertices = function(p, vertices) {
    p.setAttribute("d", vertices.map(ea => {
        var s = ea.c + " " + ea.x1 + " " + ea.y1;
        if (typeof ea.x2 !== 'undefined') s +=  " " + ea.x2 + " " + ea.y2
        return s 
      }).join(" "))
  }
  
  // var verts = getVertices(l)
  // verts[0].x = verts[0].x  + 100
  // setVertices(l, verts)

  updateVertsPos = function(p, i, pos) {
    var verts = getVertices(p)
    verts[i].x1 = pos.x
    verts[i].y1 = pos.y
    setVertices(p, verts)
  } 
  
  // updateVertsPos(l, 0, {x: 100, y: 100})
  
  
  p.onmousedown = function(evt){
      lively.notify("down")

      var offsetX = evt.clientX
      var offsetY = evt.clientY
      var posX = parseFloat(p.getAttribute("cx")) 
      var posY = parseFloat(p.getAttribute("cy")) 
    
      lively.removeEventListener("svgpath", document.body)
      lively.addEventListener("svgpath", document.body, "mousemove" , (evt) => {
        // lively.notify("move " + (posY + evt.clientY - offsetY))
        var x = posX + evt.clientX - offsetX
        var y = posY + evt.clientY - offsetY
        
        p.setAttribute("cx", x)
        p.setAttribute("cy", y)
        t.setAttribute("x", x)
        t.setAttribute("y", y)
      
        updateVertsPos(l, 0, {x: x, y: y})
        updateVertsPos(c, 0, {x: x, y: y})
        
        evt.stopPropagation();
      })
      lively.addEventListener("svgpath", document.body, "mouseup" , (ect) => {
        lively.notify("up")

        lively.removeEventListener("svgpath", document.body)
      })
      evt.stopPropagation();
      evt.preventDefault();
  }
  
</script>

